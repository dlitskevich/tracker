<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>â€¢</title>
    <link rel="stylesheet" href="vendor/spectre.min.css" />
    <link rel="stylesheet" href="vendor/spectre-icons.min.css" />
    <link rel="stylesheet" href="vendor/spectre-exp.min.css" />
    <link rel="stylesheet" href="index.css?v=2" />
    <link rel="preconnect" href="https://script.googleusercontent.com" />
    <link rel="preconnect" href="https://script.google.com" />
  </head>
  <body></body>
  <script src="index.js"></script>
  <script src="vendor/arrmatura.js"></script>
  <script>
    var lib = arrmatura.lib;
    var params = lib.urlParse(window.location.search).params;
    var key =
      "AKfycbwoWyFt17GjKCPHXX5a27dwq7pXyQQxKllQ5Gf8BtJgLd-g-rAr7V4DlrDS3bpcq4XCcw";
    var apiBaseUrl = "https://script.google.com/macros/s/" + key + "/exec";
    var metaUrl = apiBaseUrl + "?action=meta";

    class TimeReportFieldController {
      init() {
        return {
          actualData: !this.data?.length ? [] : JSON.parse(this.data),
        };
      }
      setActualData(data) {
        this.actualData = data;
        this.onChange?.({ value: !data.length ? "" : JSON.stringify(data) });
      }
      onNote({ value: note, id }, { actualData, newReport }) {
        if (!id) {
          return { newReport: { ...newReport, note } };
        }
        return {
          actualData: actualData.map((e) => (e.id == id ? { ...e, note } : e)),
        };
      }
      onHours({ value: hours, id }, { actualData, newReport }) {
        if (!id) {
          return { newReport: { ...newReport, hours } };
        }
        return {
          actualData: actualData.map((e) => (e.id == id ? { ...e, hours } : e)),
        };
      }
      onAddReport({ note = "note", hours = "8" }, { actualData, newReport }) {
        return {
          actualData: [{ ...newReport, id: Date.now() }, ...actualData],
        };
      }
      onDelReport({ id }, { actualData }) {
        return {
          actualData: actualData.filter((e) => e.id != id),
        };
      }
    }

    fetch("index.xml")
      .then((res) => res.text())
      .then((text) => {
        arrmatura(`<App metaUrl="${metaUrl}"/>`, {
          types: [text, TimeReportFieldController],
          resources: {
            apiBaseUrl,
            params,
          },
        });
      });
  </script>
</html>
