<component id="ReferencesPage">
  <GSheetsService ui:ref="dbKb" kind="kb" persistence="local" submit="-> api.post" />
  <Navbar caption="References">
    <Navbar:right>
        <DbLoadingIndicator isLoading="<- dbKb.isLoading" action="-> dbKb.reload"/>
    </Navbar:right>
  </Navbar>
  <main>
    <ui:tag tag="Ref{article.type|capitalize|or:TopArticle}" ui:props="{article}" ui:for="article of <-dbKb.items|kbAdapter|log:kbAdapter" />
  </main>
</component>

<component id="RefTree">
  <ul class="nav {class}">
    <li class="nav-item {itemClass} {item.class}" ui:for="item of data">
      <ui:tag tag="Ref{article.type|capitalize|or:TreeItem}" ui:props="{item}" item="{item}" level="{level|or:4}" />
    </li>
  </ul>
</component>

<component id="RefTreeItem">
  <ui:fragment ui:if="data">
    <ui:then>
      <a class="c-hand {class}" data-opened="{opened|not}" click="->">
        <h4 style="display:inline-block;">{name}</h4>
        <span class="label label-warn" ui:if="{label}">{label}</span>
      </a>
      <div class="bg-secondary p-2" ui:if="opened">
        <RefTree data="{data}" level="{level|plus:1}" />
      </div>
    </ui:then>
    <ui:else>
      <ui:tag tag="Ref{type|capitalize|or:Link}" ui:props="{item}" />
    </ui:else>
  </ui:fragment>

</component>

<component id="RefText">
  <div class="p-2">
    <b>{name}</b>
    <div>{content}</div>
  </div>
</component>

<component id="RefLink">
  <a href="{content}" target="_blank" class="c-hand {class}">
    <ui:tag tag="h{level}" style="display:inline-block;">{name}</ui:tag>
    <span class="label label-warn" ui:if="{label}">{label}</span>
  </a>
</component>

<component id="RefTopArticle">
  <article class="m-2 p-2">
    <a class="c-hand {class}" data-opened="{opened|not}" click="->">
      <h4 style="display:inline-block;">{name}</h4>
      <span class="label label-warn" ui:if="{label}">{label}</span>
    </a>
    <div class="bg-secondary p-2" ui:if="opened">
      <RefTree ui:if="{data}" data="{data}" level="5" />
    </div>
  </article>
</component>

 